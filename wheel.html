<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spinning Wheel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Winwheel.js/2.8.0/Winwheel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #canvas {
            border: 2px solid #ffffff;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="400" height="400"></canvas>
    <script>
        // Отримуємо userId з URL, якщо потрібно
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');

        let theWheel = new Winwheel({
            'numSegments': 8,
            'outerRadius': 180,
            'textFontSize': 16,
            'segments': [
                {'fillStyle': '#eae56f', 'text': '10 Points'},
                {'fillStyle': '#89f26e', 'text': '20 Points'},
                {'fillStyle': '#7de6ef', 'text': '30 Points'},
                {'fillStyle': '#e7706f', 'text': '40 Points'},
                {'fillStyle': '#eae56f', 'text': '50 Points'},
                {'fillStyle': '#89f26e', 'text': '60 Points'},
                {'fillStyle': '#7de6ef', 'text': '70 Points'},
                {'fillStyle': '#e7706f', 'text': '100 Points'}
            ],
            'animation': {
                'type': 'spinToStop',
                'duration': 5,
                'spins': 8,
                'callbackFinished': alertPrize
            }
        });

        // Запускаємо обертання при натисканні на колесо
        document.getElementById('canvas').addEventListener('click', function() {
            theWheel.startAnimation();
        });

        function alertPrize(indicatedSegment) {
            alert("Ви виграли: " + indicatedSegment.text);

            // Надсилаємо результат на сервер для оновлення балів користувача
            fetch('/api/wheel-result', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    userId: userId,
                    prize: indicatedSegment.text
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Результат збережено:', data);
            })
            .catch((error) => {
                console.error('Помилка:', error);
            });
        }
    </script>
</body>
</html>
